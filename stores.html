<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Kado Supermarkets Map</title>

    <!-- Leaflet -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        #sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 320px;
            height: 100%;
            background: #ffffff;
            border-left: 2px solid #ccc;
            padding: 15px;
            display: none;
            z-index: 1000;
            overflow-y: auto;
        }

        #close-btn {
            float: right;
            cursor: pointer;
            font-size: 18px;
        }
    </style>
</head>

<body>

<div id="map"></div>

<div id="sidebar">
    <span id="close-btn" onclick="closeSidebar()">✖</span>
    <h3 id="sidebar-title"></h3>
    <div id="sidebar-content"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // ---------- MAP SETUP ----------
    const map = L.map("map").setView([9.072264, 7.491302], 14);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors"
    }).addTo(map);

    // ---------- SIDEBAR FUNCTIONS ----------
    function openSidebar(title, content) {
        document.getElementById("sidebar-title").innerHTML = title;
        document.getElementById("sidebar-content").innerHTML = content;
        document.getElementById("sidebar").style.display = "block";
    }

    function closeSidebar() {
        document.getElementById("sidebar").style.display = "none";
    }

    // ---------- LOAD GEOJSON ----------
    fetch("supermarkets.geojson")
        .then(response => response.json())
        .then(data => {

            const geoLayer = L.geoJSON(data, {
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng);
                },
                onEachFeature: function (feature, layer) {

                    layer.on("click", function () {
                        const props = feature.properties;

                        openSidebar(
                            props["Super Market"],
                            `
                            <p><b>${props["Super Market"]}</b></p>
                            <a href="${props["google_map_link"]}" target="_blank">
                                View on Google Maps
                            </a>
                            `
                        );
                    });
                }
            }).addTo(map);

            map.fitBounds(geoLayer.getBounds());
        })
        .catch(err => console.error("GeoJSON load error:", err));
</script>

</body>
</html>
