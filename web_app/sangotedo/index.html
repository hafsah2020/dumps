<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Public Data Portal</title>
<style>
  body { font-family: Arial; margin:0; padding:12px; background:#f4f6f8; }
  .tabs { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
  .tab-btn { padding:8px 14px; border:none; border-radius:6px; background:#e0e0e0; cursor:pointer; }
  .tab-btn.active { background:#1a73e8; color:white; }
  .search-box { margin-bottom:12px; }
  .search-box input { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; }
  .card { background:white; border-radius:8px; padding:12px; margin-bottom:12px; border:1px solid #ddd; cursor:pointer; }
  .card:hover { background:#fafafa; }
  .card-summary h3 { margin:0 0 6px 0; }
  .card-details { margin-top:10px; border-top:1px solid #eee; padding-top:10px; display:none; }
  .badge { display:inline-block; padding:2px 8px; border-radius:4px; color:white; font-size:0.8em; margin-right:4px; }
  .badge.new { background:#f39c12; }
  .badge.followup { background:#27ae60; }
  .badge.closed { background:#c0392b; }
  .badge.default { background:#7f8c8d; }
  .tab-content { display:none; }
  .tab-content.active { display:block; }
</style>
</head>
<body>

<div class="tabs">
  <button class="tab-btn" onclick="openTab('Restaurants', this)">Restaurants</button>
  <button class="tab-btn" onclick="openTab('Hotels', this)">Hotels</button>
  <button class="tab-btn" onclick="openTab('Caterers', this)">Caterers</button>
</div>

<div class="search-box">
  <input type="text" placeholder="Search by Brand or Stage..." oninput="filterCards(this.value)">
</div>

<div id="Restaurants" class="tab-content"></div>
<div id="Hotels" class="tab-content"></div>
<div id="Caterers" class="tab-content"></div>

<script>
// Sheet CSV URLs
const sheets = {
  "Restaurants": "https://docs.google.com/spreadsheets/d/1b6xdUh5sD6ofLIw2qhsF-bWbgtdvqO0M0Kd6ikAVyEw/export?format=csv&gid=0",
  "Hotels": "https://docs.google.com/spreadsheets/d/1b6xdUh5sD6ofLIw2qhsF-bWbgtdvqO0M0Kd6ikAVyEw/export?format=csv&gid=504215961",
  "Caterers": "https://docs.google.com/spreadsheets/d/1b6xdUh5sD6ofLIw2qhsF-bWbgtdvqO0M0Kd6ikAVyEw/export?format=csv&gid=1156167092"
};

// Load all sheets
async function loadSheets() {
  for (const [name, url] of Object.entries(sheets)) {
    const csv = await fetch(url).then(r=>r.text());
    const data = csvToJson(csv);
    renderCards(name, data);
  }
}

// Simple CSV â†’ JSON
function csvToJson(csv) {
  const lines = csv.split('\n').filter(l=>l.trim()!=="");
  const headers = lines.shift().split(',');
  return lines.map(line=>{
    const row = line.split(',');
    let obj = {};
    headers.forEach((h,i)=>obj[h.trim()]=row[i]?.trim()||"");
    // Add badge class
    const stage = (obj["Stage"]||"").toLowerCase();
    if(stage==="new") obj.badgeClass="new";
    else if(stage==="followup") obj.badgeClass="followup";
    else if(stage==="closed") obj.badgeClass="closed";
    else obj.badgeClass="default";
    return obj;
  });
}

// Render cards
function renderCards(tab, data) {
  const container = document.getElementById(tab);
  container.innerHTML = "";
  data.forEach(row=>{
    const card = document.createElement('div');
    card.className = "card";
    card.dataset.brand = (row["Brand Name"]||"").toLowerCase();
    card.dataset.stage = (row["Stage"]||"").toLowerCase();
    card.innerHTML = `
      <div class="card-summary">
        <h3>${row["Brand Name"]||""}</h3>
        <p><strong>Stage:</strong> <span class="badge ${row.badgeClass}">${row["Stage"]||""}</span></p>
        <p><strong>Phone:</strong> ${row["Phone Number"]||""}</p>
      </div>
      <div class="card-details">
        <p><strong>Address:</strong> ${row["Address"]||""}</p>
        <p><strong>Email:</strong> ${row["Email"]||""}</p>
        <p><strong>Google Map:</strong> <a href="${row["Google Map Link"]||"#"}" target="_blank">Open</a></p>
        <p><strong>Date of 1st Contact:</strong> ${row["Date of 1st Contact"]||""}</p>
        <p><strong>Contact Method:</strong> ${row["Contact Method"]||""}</p>
        <p><strong>Conversation:</strong> ${row["Details on Conversation"]||""}</p>
        <p><strong>Next Contact Date:</strong> ${row["Planned Next Date of Contact"]||""}</p>
      </div>
    `;
    card.onclick = ()=>card.querySelector('.card-details').classList.toggle('hidden');
    container.appendChild(card);
  });
}

// Tab switching
function openTab(tabId, btn) {
  document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  btn.classList.add('active');
  document.querySelector('.search-box input').value="";
  filterCards('');
}

// Search filter
function filterCards(query) {
  query = query.toLowerCase();
  const activeTab = document.querySelector('.tab-content.active');
  if(!activeTab) return;
  activeTab.querySelectorAll('.card').forEach(card=>{
    const brand = card.dataset.brand;
    const stage = card.dataset.stage;
    card.style.display = (brand.includes(query)||stage.includes(query)) ? "" : "none";
  });
}

// Init
document.addEventListener("DOMContentLoaded", ()=>{
  loadSheets();
  document.querySelector('.tab-btn').click();
});
</script>
</body>
</html>
